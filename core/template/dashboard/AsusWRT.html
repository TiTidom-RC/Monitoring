<div class="eqLogic eqLogic-widget text-center allowResize #custom_layout# #eqLogic_class# #class# #category#" data-eqType="#eqType#" data-eqLogic_id="#id#" data-eqLogic_uid="#uid#" data-version="#version#" data-translate-category="#translate_category#" data-category="#category#" data-tags="#tags#" style="width: #width#;height: #height#;#style#;">
	<style>
		div.eqLogic-widget[data-eqLogic_uid="#uid#"] .cmd.monitor-btn {
			font-size: 12px !important;
		}

		div.eqLogic-widget[data-eqLogic_uid="#uid#"].editingMode .cmd.monitor-btn {
			display: none !important;
		}

		div.eqLogic-widget[data-eqLogic_uid="#uid#"] div.widget-name.monitor-name-flex {
			display: flex;
			justify-content: space-between;
			padding-left: 5px !important;
		}

		div.eqLogic-widget[data-eqLogic_uid="#uid#"] div.monitor-name-left {
			display: flex;
			flex: 0 1 auto;
			float: left;
			justify-content: flex-start;
			align-items: center;
			box-sizing: border-box;
		}

		div.eqLogic-widget[data-eqLogic_uid="#uid#"] div.monitor-name-left span:not(:empty) {
			padding-right: 3px;
		}

		div.eqLogic-widget[data-eqLogic_uid="#uid#"] div.widget-name {
			overflow: auto;
		}

		div.eqLogic-widget[data-eqLogic_uid="#uid#"] div.widget-name.monitor-name-center {
			display: flex;
			flex: 1 1 auto;
			justify-content: center;
			text-align: center;
			padding-left: 5px;
			padding-right: 5px;
			box-sizing: border-box;
		}

		div.eqLogic-widget[data-eqLogic_uid="#uid#"] div.widget-name.monitor-name-center a {
			overflow: hidden !important;
			text-overflow: ellipsis;
			white-space: nowrap;
		}

		div.eqLogic-widget[data-eqLogic_uid="#uid#"] div.monitor-name-right {
			display: flex;
			flex: 0 1 auto;
			float: right;
			justify-content: flex-end;
			align-items: center;
			box-sizing: border-box;
		}

		div.eqLogic-widget[data-eqLogic_uid="#uid#"] div.monitor-name-right .cmd.refresh {
			margin-top: unset !important;
			padding-right: 5px;
			color: inherit !important;
		}

		div.eqLogic-widget[data-eqLogic_uid="#uid#"] div.monitor-cmds {
			display: block;
			text-align: left;
			padding-left: 5px;
			overflow: auto;
			white-space: nowrap;
			width: 100%;
			height: calc(100% - 24px);
			box-sizing: border-box;
		}
	</style>
	<div class="widget-name monitor-name-flex">
		<div class="monitor-name-left">
			<span id="iconSSH#id#" class="cmd monitor-btn"></span>
			<span id="iconCron#id#" class="cmd monitor-btn"></span>
			<span id="iconCheckFirmware#id#" class="cmd monitor-btn"></span>
			<span class="cmd action reboot cursor" title="Redémarrer l'équipement" data-type="action" data-subtype="other" data-cmd_id="#cmd_reboot_id#" style="display: #cmd_reboot_display#;">
				<i class="cmd monitor-btn fas fa-redo"></i>
			</span>
		</div>
		<div class="widget-name monitor-name-center">
			<span class="reportModeVisible">#name_display# <span class="object_name">#object_name#</span></span>
			<a href="#eqLink#" class="reportModeHidden">#name_display# <span class="object_name">#object_name#</span></a>
		</div>
		<div class="monitor-name-right">
			<span class="cmd refresh cursor" title="Rafraîchir" data-cmd_id="#refresh_id#">
				<i class="fas fa-sync"></i>
			</span>
		</div>
	</div>
	<div class="monitor-cmds">
		<div class="tooltips" style="display: #distri_name_display#;">
			<span
				title="Distribution AsusWRT<br><i>Date de valeur : #distri_name_value#<br>Date de collecte : #distri_name_collect#</i>"
				style="width:15px;max-width:15px;max-height:15px;">#distri_name_icon#</span>
			<span>#distri_name#</span>
		</div>
		<div class="tooltips" style="display: #uptime_display#;">
			<span
				title="Temps d'Activité (UpTime)<br><i>Date de valeur : #uptime_value#<br>Date de collecte : #uptime_collect#</i>"
				style="width:15px;max-width:15px;max-height:15px;">#uptime_icon#</span>
			<span id="uptime#id#"></span>
		</div>
		<div class="tooltips" style="display: #load_avg_display#;">
			<span
				title="Charge Système (Load Average)<br><i>Date de valeur : #load_avg_value#<br>Date de collecte : #load_avg_collect#</i>"
				style="width:15px;max-width:15px;max-height:15px;">#load_avg_icon#</span>
			<span id="load_avg_1mn#id#"></span><span id="load_avg_5mn#id#"></span><span id="load_avg_15mn#id#"></span>
		</div>
		<div class="tooltips" style="display: #memory_display#;">
			<span
				title="Mémoire Vive (% Disponible)<br><i>Date de valeur : #memory_value#<br>Date de collecte : #memory_collect#</i>"
				style="width:15px;max-width:15px;max-height:15px;">#memory_icon#</span>
			<span id="memory_available_percent#id#"></span>
		</div>
		<div class="tooltips" style="display: #swap_display#;">
			<span
				title="Mémoire Swap (% Libre)<br><i>Date de valeur : #swap_value#<br>Date de collecte : #swap_collect#</i>"
				style="width:15px;max-width:15px;max-height:15px;">#swap_icon#</span>
			<span id="swap_free_percent#id#"></span>
		</div>
		<div class="tooltips" style="display: #network_infos_display#;">
			<span
				title="Infos Réseau<br><i>Date de valeur : #network_infos_value#<br>Date de collecte : #network_infos_collect#</i>"
				style="width:15px;max-width:15px;max-height:15px;">#network_infos_icon#</span>
			<span id="network_infos#id#"></span>
		</div>
		<div class="tooltips" style="display: #network_display#;">
			<span
				title="Trafic Réseau (#network_name# / #network_ip#)<br><i>Date de valeur : #network_value#<br>Date de collecte : #network_collect#</i>"
				style="width:15px;max-width:15px;max-height:15px;">#network_icon#</span>
			<span id="network#id#"></span>
		</div>
		<div class="tooltips" style="display: #asus_clients_display#;">
			<span
				title="Infos Clients<br><i>Date de valeur : #asus_clients_value#<br>Date de collecte : #asus_clients_collect#</i>"
				style="width:15px;max-width:15px;max-height:15px;">#asus_clients_icon#</span>
			<span id="asus_clients#id#"></span>
		</div>
		<div class="tooltips" style="display: #asus_wan0_ip_display#;">
			<span
				title="Infos Internet (WAN)<br><i>Date de valeur : #asus_wan0_ip_value#<br>Date de collecte : #asus_wan0_ip_collect#</i>"
				style="width:15px;max-width:15px;max-height:15px;">#asus_wan0_ip_icon#</span>
			<span id="asus_wan0_ip#id#"></span>
		</div>
		<div class="tooltips" style="display: #asus_wifi_temp_display#;">
			<span
				title="Infos Températures WiFi<br><i>Date de valeur : #asus_wifi_temp_value#<br>Date de collecte : #asus_wifi_temp_collect#</i>"
				style="width:15px;max-width:15px;max-height:15px;">#asus_wifi_temp_icon#</span>
			<span id="asus_wifi_temp#id#"></span>
		</div>
		<div class="tooltips" style="display: #hdd_display#;">
			<span
				title="Espace Disque (% Libre)<br><i>Date de valeur : #hdd_value#<br>Date de collecte : #hdd_collect#</i>"
				style="width:15px;max-width:15px;max-height:15px;">#hdd_icon#</span>
			<span id="hdd#id#"></span>
		</div>
		<div class="tooltips" style="display: #cpu_display#;">
			<span
				title="Nombre CPU - Fréquence (Température)<br><i>Date de valeur : #cpu_value#<br>Date de collecte : #cpu_collect#</i>"
				style="width:15px;max-width:15px;max-height:15px;">#cpu_icon#</span>
			<span id="cpu#id#"></span><span id="cpu_temp#id#"></span>
		</div>
		<div class="tooltips" style="display: #perso1_display#;" data-perso-id="perso1" data-perso-value="#perso1#"
			data-perso-name="#perso1_name#" data-perso-low="#perso1_colorlow#" data-perso-high="#perso1_colorhigh#"
			data-perso-cmd-id="#perso1_id#" data-perso-unite="#perso1_unite#" data-perso-tendance="#perso1_tendance#"
			data-perso-history='{"min":"#perso1_minHistory#","avg":"#perso1_averageHistory#","max":"#perso1_maxHistory#"}'>
			<span title="#perso1_name#<br><i>Date de valeur : #perso1_value#<br>Date de collecte : #perso1_collect#</i>" style="width:15px;max-width:15px;max-height:15px;">#perso1_icon#</span>
			<span id="perso1_unite#id#"></span>
		</div>
		<div class="tooltips" style="display: #perso2_display#;" data-perso-id="perso2" data-perso-value="#perso2#"
			data-perso-name="#perso2_name#" data-perso-low="#perso2_colorlow#" data-perso-high="#perso2_colorhigh#"
			data-perso-cmd-id="#perso2_id#" data-perso-unite="#perso2_unite#" data-perso-tendance="#perso2_tendance#"
			data-perso-history='{"min":"#perso2_minHistory#","avg":"#perso2_averageHistory#","max":"#perso2_maxHistory#"}'>
			<span title="#perso2_name#<br><i>Date de valeur : #perso2_value#<br>Date de collecte : #perso2_collect#</i>" style="width:15px;max-width:15px;max-height:15px;">#perso2_icon#</span>
			<span id="perso2_unite#id#"></span>
		</div>
		<div class="tooltips" style="display: #perso3_display#;" data-perso-id="perso3" data-perso-value="#perso3#"
			data-perso-name="#perso3_name#" data-perso-low="#perso3_colorlow#" data-perso-high="#perso3_colorhigh#"
			data-perso-cmd-id="#perso3_id#" data-perso-unite="#perso3_unite#" data-perso-tendance="#perso3_tendance#"
			data-perso-history='{"min":"#perso3_minHistory#","avg":"#perso3_averageHistory#","max":"#perso3_maxHistory#"}'>
			<span title="#perso3_name#<br><i>Date de valeur : #perso3_value#<br>Date de collecte : #perso3_collect#</i>" style="width:15px;max-width:15px;max-height:15px;">#perso3_icon#</span>
			<span id="perso3_unite#id#"></span>
		</div>
		<div class="tooltips" style="display: #perso4_display#;" data-perso-id="perso4" data-perso-value="#perso4#"
			data-perso-name="#perso4_name#" data-perso-low="#perso4_colorlow#" data-perso-high="#perso4_colorhigh#"
			data-perso-cmd-id="#perso4_id#" data-perso-unite="#perso4_unite#" data-perso-tendance="#perso4_tendance#"
			data-perso-history='{"min":"#perso4_minHistory#","avg":"#perso4_averageHistory#","max":"#perso4_maxHistory#"}'>
			<span title="#perso4_name#<br><i>Date de valeur : #perso4_value#<br>Date de collecte : #perso4_collect#</i>" style="width:15px;max-width:15px;max-height:15px;">#perso4_icon#</span>
			<span id="perso4_unite#id#"></span>
		</div>
	</div>
	#divGraphInfo#
	<script>
		(() => {
			'use strict'

			// Get reference to this specific widget container
			const widgetRoot = document.querySelector('.eqLogic-widget[data-eqLogic_uid="#uid#"]')
			if (!widgetRoot) return

			/**
			 * Safely parse JSON from data attribute
			 * @param {string} jsonString - JSON string to parse
			 * @param {object} fallback - Fallback value if parsing fails
			 * @returns {object} Parsed object or fallback
			 */
			const safeJSONParse = (jsonString, fallback = { min: '-', avg: '-', max: '-' }) => {
				if (!jsonString || jsonString === 'undefined' || jsonString === '') return fallback
				try {
					return JSON.parse(jsonString)
				} catch (e) {
					console.warn('[Monitoring AsusWRT] JSON parse error:', e, 'Input:', jsonString)
					return fallback
				}
			}

			// ========================================
			// === UTILITY FUNCTIONS ===
			// ========================================

			/**
			 * Get color style based on value and thresholds
			 * @param {number} val - Numeric value to evaluate
			 * @param {number} low - Low threshold
			 * @param {number} high - High threshold
			 * @param {boolean} reversed - If true, higher values are better (green)
			 * @returns {string} Inline style string for color
			 */
			const getColorStyle = (val, low, high, reversed = false) => {
				if (reversed) {
					// Reversed: higher is better (e.g., % free)
					if (val > high && high !== '') return ' style="color: var(--al-success-color) !important;"'
					if (val >= low && val <= high) return ' style="color: var(--al-warning-color) !important;"'
					if (val < low) return ' style="color: var(--al-danger-color) !important;"'
				} else {
					// Normal: lower is better (e.g., temperature, load)
					if (val < low) return ' style="color: var(--al-success-color) !important;"'
					if (val >= low && val <= high) return ' style="color: var(--al-warning-color) !important;"'
					if (val > high && high !== '') return ' style="color: var(--al-danger-color) !important;"'
				}
				return ''
			}

			/**
			 * Build HTML for threshold-based value with color
			 * @param {string} value - Value to display
			 * @param {string} lowThreshold - Low threshold value
			 * @param {string} highThreshold - High threshold value
			 * @param {string} label - Label for tooltip
			 * @param {string} cmdId - Command ID
			 * @param {object} history - History stats {min, avg, max}
			 * @param {string} tendance - Trend indicator
			 * @param {boolean} reversed - If true, higher values are better
			 * @returns {string} HTML string
			 */
			const buildThresholdHTML = (value, lowThreshold, highThreshold, label, cmdId, history, tendance, reversed = false) => {
				if (value === '') return '<span></span>'

				const val = parseFloat(value)
				const low = parseFloat(lowThreshold)
				const high = parseFloat(highThreshold)
				const title = `Stats : ${label}<br>Min: ${history.min} | Moy : ${history.avg} | Max : ${history.max}`
				const color = getColorStyle(val, low, high, reversed)

				return `<span title="${title}" data-cmd_id="${cmdId}" class="value history cursor tooltips"${color}>${value}${tendance}</span>`
			}

			/**
			 * Build HTML for percentage-based value with color and unit
			 * @param {string} value - Value to display
			 * @param {string} lowThreshold - Low threshold value
			 * @param {string} highThreshold - High threshold value
			 * @param {string} label - Label for tooltip
			 * @param {string} cmdId - Command ID
			 * @param {object} history - History stats {min, avg, max}
			 * @param {string} tendance - Trend indicator
			 * @param {string} prefix - Prefix text (e.g., "#memory# (")
			 * @param {string} unit - Unit (e.g., "%")
			 * @param {boolean} reversed - If true, higher values are better
			 * @returns {string} HTML string
			 */
			const buildPercentageHTML = (value, lowThreshold, highThreshold, label, cmdId, history, tendance, prefix, unit, reversed = false) => {
				if (value === '') return prefix ? '<span></span>' : ''

				const val = parseFloat(value)
				const low = parseFloat(lowThreshold)
				const high = parseFloat(highThreshold)
				const title = `Stats : ${label}<br>Min: ${history.min} | Moy : ${history.avg} | Max : ${history.max}`
				const color = getColorStyle(val, low, high, reversed)

				const valueSpan = `<span title="${title}" data-cmd_id="${cmdId}" class="value history cursor tooltips"${color}>${value}</span>`
				const unitSpan = `<span>${unit}${tendance}</span>`

				return prefix ? `${prefix}${valueSpan}${unitSpan})` : `${valueSpan}${unitSpan}`
			}

			// ========================================
			// === ICON HANDLERS ===
			// ========================================

			/**
			 * Initialize SSH connection status icon
			 */
			const initIconSSH = () => {
				try {
					const iconSSH = widgetRoot.querySelector('#iconSSH#id#')
					if (!iconSSH) return

					if ('#cnx_ssh#' === 'OK') {
						iconSSH.innerHTML = '<i title="Connexion SSH OK" class="cmd monitor-btn fas fa-check tooltips" style="color: var(--al-success-color) !important;"></i>'
					} else if ('#cnx_ssh#' === 'KO') {
						iconSSH.innerHTML = '<i title="Connexion SSH KO" class="cmd monitor-btn fas fa-times-circle tooltips" style="color: var(--al-danger-color) !important;"></i>'
					}
				} catch (e) {
					console.error('[Monitoring AsusWRT] Error in initIconSSH:', e)
				}
			}

			/**
			 * Initialize Cron status icon
			 */
			const initIconCron = () => {
				try {
					const iconCron = widgetRoot.querySelector('#iconCron#id#')
					if (!iconCron) return

					const isOn = '#cron_status#' === '1'
					const isCustom = '#cron_status_custom#' === '1'
					const display = '#cron_status_display#'

					const icon = isOn ? 'play-circle' : 'pause-circle'
					const label = isOn ? 'ON' : 'OFF'
					const customLabel = isCustom ? ' (Custom)' : ' (Default)'
					const color = isCustom ? '--al-warning-color' : (isOn ? '--al-success-color' : '--al-danger-color')

					iconCron.innerHTML = `<i title="Cron ${label}${customLabel}" class="cmd monitor-btn fas fa-${icon} tooltips" style="display: ${display};color: var(${color}) !important;"></i>`
				} catch (e) {
					console.error('[Monitoring AsusWRT] Error in initIconCron:', e)
				}
			}

			/**
			 * Initialize firmware check icon
			 */
			const initIconCheckFirmware = () => {
				try {
					const el = widgetRoot.querySelector('#iconCheckFirmware#id#')
					if (!el) return

					if ('#asus_fw_check#' === '1') {
						el.innerHTML = '<i title="Check du Firmware :: 1" class="cmd monitor-btn fas fa-bell tooltips" style="display: #asus_fw_check_display#;color: var(--al-success-color) !important;"></i>'
					} else if ('#asus_fw_check#' === '0') {
						el.innerHTML = '<i title="Check du Firmware :: 0" class="cmd monitor-btn fas fa-bell-slash tooltips" style="display: #asus_fw_check_display#;color: var(--al-danger-color) !important;"></i>'
					}
				} catch (e) {
					console.error('[Monitoring AsusWRT] Error in initIconCheckFirmware:', e)
				}
			}

			// ========================================
			// === BUTTON HANDLERS ===
			// ========================================

			/**
			 * Initialize Reboot button with confirmation dialog
			 */
			const initRebootButton = () => {
				try {
					const rebootBtn = widgetRoot.querySelector('.reboot[data-cmd_id="#cmd_reboot_id#"]')
					rebootBtn?.addEventListener('click', () => {
						jeeDialog.confirm({
							title: '<i class="warning fas fa-question-circle"></i> Redémarrer l\'équipement',
							message: 'Etes-vous sûr de vouloir redémarrer l\'équipement #name# ?',
							buttons: {
								confirm: { label: 'Redémarrer', className: 'warning' },
								cancel: { label: 'Annuler', className: 'info' }
							},
							callback: result => result && jeedom.cmd.execute({ id: '#cmd_reboot_id#' })
						})
					})
				} catch (e) {
					console.error('[Monitoring AsusWRT] Error in initRebootButton:', e)
				}
			}

			/**
			 * Initialize Refresh button
			 */
			const initRefreshButton = () => {
				try {
					const refreshBtn = widgetRoot.querySelector('.refresh')
					if (!refreshBtn) return

					if ('#refresh_id#' !== '') {
						refreshBtn.addEventListener('click', () => jeedom.cmd.execute({ id: '#refresh_id#' }))
					} else {
						refreshBtn.remove()
					}
				} catch (e) {
					console.error('[Monitoring AsusWRT] Error in initRefreshButton:', e)
				}
			}

			// ========================================
			// === VALUE DISPLAYS - Simple ===
			// ========================================

			/**
			 * Initialize Uptime display
			 */
			const initUptime = () => {
				try {
					if ('#cnx_ssh#' !== 'OK' && '#cnx_ssh#' !== 'No') return

					const uptimeEl = widgetRoot.querySelector('#uptime#id#')
					if (uptimeEl) uptimeEl.innerHTML = '<span>#uptime#</span>'
				} catch (e) {
					console.error('[Monitoring AsusWRT] Error in initUptime:', e)
				}
			}

			/**
			 * Initialize Network Infos display
			 */
			const initNetworkInfos = () => {
				try {
					if ('#cnx_ssh#' !== 'OK' && '#cnx_ssh#' !== 'No') return

					const networkInfosEl = widgetRoot.querySelector('#network_infos#id#')
					if (networkInfosEl) networkInfosEl.innerHTML = '<span>#network_infos#</span>'
				} catch (e) {
					console.error('[Monitoring AsusWRT] Error in initNetworkInfos:', e)
				}
			}

			/**
			 * Initialize Network display
			 */
			const initNetwork = () => {
				try {
					if ('#cnx_ssh#' !== 'OK' && '#cnx_ssh#' !== 'No') return

					const networkEl = widgetRoot.querySelector('#network#id#')
					if (networkEl) networkEl.innerHTML = '<span>#network#</span>'
				} catch (e) {
					console.error('[Monitoring AsusWRT] Error in initNetwork:', e)
				}
			}

			/**
			 * Initialize Asus Clients display
			 */
			const initAsusClients = () => {
				try {
					if ('#cnx_ssh#' !== 'OK' && '#cnx_ssh#' !== 'No') return

					const el = widgetRoot.querySelector('#asus_clients#id#')
					if (el) el.innerHTML = '<span>#asus_clients#</span>'
				} catch (e) {
					console.error('[Monitoring AsusWRT] Error in initAsusClients:', e)
				}
			}

			/**
			 * Initialize Asus WAN0 IP display
			 */
			const initAsusWan0IP = () => {
				try {
					if ('#cnx_ssh#' !== 'OK' && '#cnx_ssh#' !== 'No') return

					const el = widgetRoot.querySelector('#asus_wan0_ip#id#')
					if (el) el.innerHTML = '<span>IP (WAN) : #asus_wan0_ip#</span>'
				} catch (e) {
					console.error('[Monitoring AsusWRT] Error in initAsusWan0IP:', e)
				}
			}

			/**
			 * Initialize Asus WiFi Temperature display
			 */
			const initAsusWifiTemp = () => {
				try {
					if ('#cnx_ssh#' !== 'OK' && '#cnx_ssh#' !== 'No') return

					const el = widgetRoot.querySelector('#asus_wifi_temp#id#')
					if (el) el.innerHTML = '<span>#asus_wifi_temp#</span>'
				} catch (e) {
					console.error('[Monitoring AsusWRT] Error in initAsusWifiTemp:', e)
				}
			}

			// ========================================
			// === VALUE DISPLAYS - With Thresholds ===
			// ========================================

			/**
			 * Initialize Load Average displays (1mn, 5mn, 15mn)
			 */
			const initLoadAverage = () => {
				try {
					if ('#cnx_ssh#' !== 'OK' && '#cnx_ssh#' !== 'No') return

					// Load avg 1mn
					const loadAvg1mn = widgetRoot.querySelector('#load_avg_1mn#id#')
					if (loadAvg1mn) {
						const html = buildThresholdHTML(
							'#load_avg_1mn#', '#load_avg_1mn_colorlow#', '#load_avg_1mn_colorhigh#',
							'Charge Système (1min)', '#load_avg_1mn_id#',
							{ min: '#load_avg_1mn_minHistory#', avg: '#load_avg_1mn_averageHistory#', max: '#load_avg_1mn_maxHistory#' },
							'#load_avg_1mn_tendance#'
						)
						loadAvg1mn.innerHTML = html === '<span></span>' ? html : `1 min : ${html}`
					}

					// Load avg 5mn
					const loadAvg5mn = widgetRoot.querySelector('#load_avg_5mn#id#')
					if (loadAvg5mn) {
						const html = buildThresholdHTML(
							'#load_avg_5mn#', '#load_avg_5mn_colorlow#', '#load_avg_5mn_colorhigh#',
							'Charge Système (5min)', '#load_avg_5mn_id#',
							{ min: '#load_avg_5mn_minHistory#', avg: '#load_avg_5mn_averageHistory#', max: '#load_avg_5mn_maxHistory#' },
							'#load_avg_5mn_tendance#'
						)
						loadAvg5mn.innerHTML = html === '<span></span>' ? html : ` - 5 min : ${html}`
					}

					// Load avg 15mn
					const loadAvg15mn = widgetRoot.querySelector('#load_avg_15mn#id#')
					if (loadAvg15mn) {
						const html = buildThresholdHTML(
							'#load_avg_15mn#', '#load_avg_15mn_colorlow#', '#load_avg_15mn_colorhigh#',
							'Charge Système (15min)', '#load_avg_15mn_id#',
							{ min: '#load_avg_15mn_minHistory#', avg: '#load_avg_15mn_averageHistory#', max: '#load_avg_15mn_maxHistory#' },
							'#load_avg_15mn_tendance#'
						)
						loadAvg15mn.innerHTML = html === '<span></span>' ? html : ` - 15 min : ${html}`
					}
				} catch (e) {
					console.error('[Monitoring AsusWRT] Error in initLoadAverage:', e)
				}
			}

			/**
			 * Initialize Memory display with percentage
			 */
			const initMemory = () => {
				try {
					if ('#cnx_ssh#' !== 'OK' && '#cnx_ssh#' !== 'No') return

					const memoryEl = widgetRoot.querySelector('#memory_available_percent#id#')
					if (!memoryEl) return

					const value = '#memory_available_percent#'
					if (value === '') {
						memoryEl.innerHTML = '<span>#memory#</span>'
						return
					}

					memoryEl.innerHTML = buildPercentageHTML(
						value, '#memory_available_percent_colorlow#', '#memory_available_percent_colorhigh#',
						'Mémoire Vive (% Disponible)', '#memory_available_percent_id#',
						{ min: '#memory_available_percent_minHistory#', avg: '#memory_available_percent_averageHistory#', max: '#memory_available_percent_maxHistory#' },
						'#memory_available_percent_tendance#', '#memory# (', '%', true
					)
				} catch (e) {
					console.error('[Monitoring AsusWRT] Error in initMemory:', e)
				}
			}

			/**
			 * Initialize Swap display with percentage
			 */
			const initSwap = () => {
				try {
					if ('#cnx_ssh#' !== 'OK' && '#cnx_ssh#' !== 'No') return

					const swapEl = widgetRoot.querySelector('#swap_free_percent#id#')
					if (!swapEl) return

					const value = '#swap_free_percent#'
					if (value === '') {
						swapEl.innerHTML = '<span></span>'
						return
					}

					swapEl.innerHTML = buildPercentageHTML(
						value, '#swap_free_percent_colorlow#', '#swap_free_percent_colorhigh#',
						'Mémoire Swap (% Libre)', '#swap_free_percent_id#',
						{ min: '#swap_free_percent_minHistory#', avg: '#swap_free_percent_averageHistory#', max: '#swap_free_percent_maxHistory#' },
						'#swap_free_percent_tendance#', '#swap# (', '%', true
					)
				} catch (e) {
					console.error('[Monitoring AsusWRT] Error in initSwap:', e)
				}
			}

			/**
			 * Initialize HDD display with percentage
			 */
			const initHDD = () => {
				try {
					if ('#cnx_ssh#' !== 'OK' && '#cnx_ssh#' !== 'No') return

					const hddEl = widgetRoot.querySelector('#hdd#id#')
					if (!hddEl) return

					const value = '#hdd_free_percent#'
					if (value === '') {
						hddEl.innerHTML = '<span></span>'
						return
					}

					hddEl.innerHTML = buildPercentageHTML(
						value, '#hdd_free_percent_colorlow#', '#hdd_free_percent_colorhigh#',
						'Espace Disque (% Libre)', '#hdd_free_percent_id#',
						{ min: '#hdd_free_percent_minHistory#', avg: '#hdd_free_percent_averageHistory#', max: '#hdd_free_percent_maxHistory#' },
						'#hdd_free_percent_tendance#', '#hdd# (', '%', true
					)
				} catch (e) {
					console.error('[Monitoring AsusWRT] Error in initHDD:', e)
				}
			}

			/**
			 * Initialize CPU display with optional temperature
			 */
			const initCPU = () => {
				try {
					if ('#cnx_ssh#' !== 'OK' && '#cnx_ssh#' !== 'No') return

					const cpuEl = widgetRoot.querySelector('#cpu#id#')
					if (!cpuEl) return

					if ('#cpu_temp#' !== '' && '#cpu_temp_display#' === 'block') {
						cpuEl.innerHTML = '<span>#cpu# </span>'

						const tempEl = widgetRoot.querySelector('#cpu_temp#id#')
						if (!tempEl) return

						const temp = parseFloat('#cpu_temp#')
						const low = parseFloat('#cpu_temp_colorlow#')
						const high = parseFloat('#cpu_temp_colorhigh#')
						const title = 'Stats : Température CPU<br>Min: #cpu_temp_minHistory# | Moy : #cpu_temp_averageHistory# | Max : #cpu_temp_maxHistory#'
						const color = getColorStyle(temp, low, high, false)

						tempEl.innerHTML = `(<span title="${title}" data-cmd_id="#cpu_temp_id#" class="value history cursor tooltips"${color}>#cpu_temp#</span><span>°C#cpu_temp_tendance#</span>)`
					} else {
						cpuEl.innerHTML = '<span>#cpu#</span>'
					}
				} catch (e) {
					console.error('[Monitoring AsusWRT] Error in initCPU:', e)
				}
			}

			/**
			 * Initialize custom command display (perso1-4) using data attributes
			 * @param {HTMLElement} container - The container div with data-perso-* attributes
			 */
			const initPerso = (container) => {
				try {
					if ('#cnx_ssh#' !== 'OK' && '#cnx_ssh#' !== 'No') return

					const dataset = container.dataset
					const persoId = dataset.persoId
					const el = widgetRoot.querySelector(`#${persoId}_unite#id#`)
					if (!el) return

					const value = dataset.persoValue
					if (value === '') {
						el.innerHTML = '<span></span>'
						return
					}

					const val = parseFloat(value)
					const low = parseFloat(dataset.persoLow)
					const high = parseFloat(dataset.persoHigh)
					const history = safeJSONParse(dataset.persoHistory)
					const title = `Stats : ${dataset.persoName}<br>Min: ${history.min} | Moy : ${history.avg} | Max : ${history.max}`
					const color = getColorStyle(val, low, high, false)

					el.innerHTML = `<span title="${title}" data-cmd_id="${dataset.persoCmdId}" class="value history cursor tooltips"${color}>${value}</span><span>${dataset.persoUnite}${dataset.persoTendance}</span>`
				} catch (e) {
					console.error('[Monitoring AsusWRT] Error in initPerso for', container.dataset?.persoId || 'unknown', ':', e)
				}
			}

			// ========================================
			// === INITIALIZATION ===
			// ========================================

			// Only initialize if template is properly instantiated
			if ('#uid#') {
				// Icon handlers
				initIconSSH()
				initIconCron()
				initIconCheckFirmware()

				// Button handlers
				initRebootButton()
				initRefreshButton()

				// Simple value displays
				initUptime()
				initNetworkInfos()
				initNetwork()
				initAsusClients()
				initAsusWan0IP()
				initAsusWifiTemp()

				// Value displays with thresholds
				initLoadAverage()
				initMemory()
				initSwap()
				initHDD()

				// CPU with temperature
				initCPU()

				// Custom commands - generic initialization using data attributes
				widgetRoot.querySelectorAll('[data-perso-id]').forEach(initPerso)
			}
		})()
	</script>
</div>